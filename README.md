# Ассистент сценариев с RAG и Google Drive

Это веб-приложение использует подход Retrieval-Augmented Generation (RAG) для создания чат-бота на основе LangChain и FastAPI. Приложение позволяет загружать и индексировать документы для семантического поиска, улучшая ответы ИИ, включая интеграцию с Google Drive для обработки документов.

## Возможности

- **Чат с ИИ:**  
  Ведите диалог с ИИ-ассистентом, который учитывает историю переписки и использует контекст из загруженных документов для более точных ответов.

- **Загрузка документов:**  
  Загружайте документы в форматах PDF, DOCX и HTML для индексирования и использования в ответах.  
  *Новое*: Поддержка загрузки целых папок с Google Drive для пакетной обработки документов.

- **Управление документами:**  
  Просматривайте список загруженных документов и удаляйте ненужные.

## Технологический стек

- **FastAPI:** Сервер для обработки API-запросов.
- **LangChain:** Управление цепочками обработки запросов с учётом контекста.
- **Chroma:** Векторное хранилище для семантического поиска по документам.
- **SQLite:** Локальная база данных для хранения истории чата и метаданных документов.
- **Streamlit:** Веб-интерфейс для взаимодействия с пользователем.
- **Google Drive API:** Интеграция для загрузки документов с Google Drive.
- **Git:** Система контроля версий.

## Структура проекта

- **api_utils.py:** Функции для отправки HTTP-запросов к серверу (чат, загрузка, получение и удаление документов).
- **chat_interface.py:** Реализация чат-интерфейса на Streamlit.
- **sidebar.py:** Боковая панель для выбора модели, загрузки документов (локальных и с Google Drive) и управления ими.
- **streamlit_app.py:** Главный файл для запуска приложения Streamlit.
- **db_utils.py:** Работа с базой данных для хранения истории чата и метаданных документов.
- **chroma_utils.py:** Индексация документов в векторное хранилище Chroma.
- **langchain_utils.py:** Создание цепочек обработки запросов с использованием LangChain и ChatOllama.
- **pydantic_models.py:** Модели Pydantic для валидации запросов и ответов.
- **hybrid_context_extractor.py:** Пользовательский гибридный ретривер для улучшенного извлечения контекста.
- **gdrive_auth.py:** Модуль аутентификации для Google Drive API.
- **gdrive_extractor.py:** Модуль для извлечения и обработки документов с Google Drive.
- **credentials.json:** Конфигурация OAuth 2.0 для Google Drive API.
- **token.json:** Хранение токенов доступа и обновления для Google Drive API.

## Требования

- Python 3.8 или выше.
- Учетные данные Google Drive API (см. раздел "Настройка Google Drive").
- Установленные зависимости из `requirements.txt`.

## Установка и запуск

1. **Клонируйте репозиторий:**

   ```bash
   git clone <URL-репозитория>
   cd <директория-репозитория>
   ```

2. **Установите зависимости:**

   ```bash
   pip install -r requirements.txt
   ```

3. **Настройка Google Drive API:**

   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/).
   - Создайте проект и включите Google Drive API.
   - Создайте учетные данные OAuth 2.0 (выберите "Desktop app") и скачайте файл `credentials.json`.
   - Поместите `credentials.json` в корневую директорию проекта.
   - При первом запуске приложение запросит аутентификацию, создав файл `token.json`.

4. **Запустите сервер FastAPI:**

   ```bash
   cd api
   uvicorn main:app --reload
   ```

5. **Запустите приложение Streamlit:**

   ```bash
   cd app
   streamlit run streamlit_app.py
   ```

6. **Откройте приложение:**

   В браузере перейдите по адресу:

   ```bash
   http://localhost:8501
   ```

## Использование

- **Чат:** Вводите запросы в интерфейсе чата. ИИ будет отвечать, используя контекст из загруженных документов, если это уместно.
- **Загрузка документов:** Используйте боковую панель для загрузки локальных файлов (PDF, DOCX, HTML) или укажите URL папки Google Drive для индексации нескольких документов.
- **Управление документами:** Просматривайте и удаляйте загруженные документы через боковую панель.

## Примечания

- Файлы `credentials.json` и `token.json` содержат чувствительные данные. Храните их в безопасности и не добавляйте в публичные репозитории.
- Поддерживаемые форматы документов: PDF, DOCX, HTML.
- Для загрузки с Google Drive требуется действительный URL папки (например, `https://drive.google.com/drive/folders/<folder-id>`).

## Вклад в проект

Приветствуются любые предложения и улучшения! Создавайте issues или pull requests, соблюдая стиль кода и добавляя тесты для новых функций.